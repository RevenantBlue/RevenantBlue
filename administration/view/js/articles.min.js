var editorTabs,fullscreenEditorTabs,activeEditor="content-editor",revisionId="",pluploadUrl,pluploadType,pluploadController;$(document).ready(function(){var noArticleError="No articles were selected. \n\nPlease select an article from the table below and try again.",noRevisionError="No revisions selected, please select a revision from the table below and try again.",uploader;if($("#date-posted").length!==0){$("#date-posted").datetimepicker({showOn:"both",buttonImage:HTTP_IMAGE+"icons/admin/calendar_icon2.png",buttonImageOnly:true,ampm:true,dateFormat:"yy-mm-dd",timeFormat:"hh:mm TT"})}if($("#profile-image").length!==0){pluploadUrl=HTTP_ADMIN+'articles?adminRequest={"type":"article","action":"upload-image"}&csrfToken='+$("#csrf-token").val();pluploadType="article";pluploadAction="upload-image";pluploadController=HTTP_ADMIN+"articles?csrfToken="+$("#csrf-token").val();deleteImgUrl=HTTP_ADMIN+"articles"}if($("#categories-tabs").length!==0){$("#categories-tabs").tabs()}if($("#category-adder").length!==0){$(".new-category-panel").hide();$("#category-add-toggle").click(function(e){e.preventDefault();$(".new-category-panel").slideToggle()})}$(".article-category").click(function(){var categoryId;if($(this).hasClass("popular-category")){categoryId=$(this).prop("id").replace("pop-cat-","");if(!$(this).is(":checked")){$("#pop-cat-"+categoryId+", #cat-"+categoryId).prop("checked",true)}else{$("#pop-cat-"+categoryId+", #cat-"+categoryId).prop("checked",false)}}else{categoryId=$(this).prop("id").replace("cat-","");if(!$(this).is(":checked")){$("#cat-"+categoryId+", #pop-cat-"+categoryId).prop("checked",false)}else{$("#cat-"+categoryId+", #pop-cat-"+categoryId).prop("checked",true)}}});$("#create-category").click(function(e){e.preventDefault();CMS.submitButton("article","add-category")});if($("#add-tag").length!==0){$("#add-tag").click(function(e){e.preventDefault();var tagsToAdd,numOfTags,tagsArr,currentTags,tagsStr,currentTagsArr,x,i;tagsToAdd=$("#tags-to-add").val();numOfTags=$("#selected-tags").children().length+1;if(tagsToAdd.length===0){return false}tagsArr=tagsToAdd.split(",");tagsArr=removeDuplicates(tagsArr);currentTags=$("#hidden-tags").val();tagsStr="";if(currentTags.length>0){currentTagsArr=currentTags.split(",")}if(tagsArr.length>0){for(x=0;x<tagsArr.length;x++){tagsArr[x]=trim(tagsArr[x]);if(typeof currentTagsArr!=="undefined"){for(i=0;i<currentTagsArr.length;i++){if(currentTagsArr[i]===tagsArr[x]){tagsArr[x]=null}}}if(tagsArr[x]!==null){if(x===0&&tagsArr.length===1||x===tagsArr.length-1){tagsStr+=tagsArr[x]}else{tagsStr+=tagsArr[x]+","}$("#selected-tags").append("<span>"+'<a id="tag-'+numOfTags+'" class="ui-icon ui-icon-close remove-tag"></a>'+tagsArr[x]+"</span>");numOfTags++}}}$("#tags-to-add").val("");if(currentTags.length===0){currentTags=tagsStr}else{currentTags+=","+tagsStr}$("#hidden-tags").val(currentTags)});$("#article-tags-panel").on("click",".remove-tag",function(e){var tagsToRemove,tagToRemove,currentTags,newCurrentTags,lastChar;e.preventDefault();tagToRemove=$(this).parent().justText().trim();$(this).parent().remove();currentTags=$("#hidden-tags").val();newCurrentTags=currentTags.replace(tagToRemove+",","");if(newCurrentTags===currentTags){newCurrentTags=currentTags.replace(tagToRemove,"")}lastChar=newCurrentTags[newCurrentTags.length-1];if(lastChar===","){newCurrentTags=newCurrentTags.slice(0,-1)}$("#hidden-tags").val(newCurrentTags)});$("#article-tags-panel").on("click","#show-popular-tags",function(e){e.preventDefault();$("#popular-tags").slideToggle()});$("#article-tags-panel").on("click",".popular-tag",function(e){var tagToAdd,currentTags,currentTagsArr,numOfTags,x;e.preventDefault();tagToAdd=$(this).justText().trim();currentTags=$("#hidden-tags").val();numOfTags=$("#selected-tags").children().length+1;if(currentTags.length>0){currentTagsArr=currentTags.split(",");for(x=0;x<currentTagsArr.length;x++){if(tagToAdd===currentTagsArr[x]){return false}}}$("#selected-tags").append('<span><a id="tag-'+numOfTags+'" class="remove-tag">x</a>'+tagToAdd);if(currentTags.length===0){currentTags=tagToAdd}else{currentTags+=","+tagToAdd}$("#hidden-tags").val(currentTags)})}if($("#content-editor").length!==0){var currentContent,idForArticle="",autoSave=false,newIdInput,newIdAdjacent;autoSave=true;$(document).everyTime(3e4,function(){switch(activeEditor){case"content-editor":if(typeof currentContent==="undefined"){if(disableTinymce){currentContent=$("#content-editor").val()}else{currentContent=$("#content-editor").html()}}if(disableTinymce){if($("#content-editor").val()!==currentContent){autosaveArticle($("#content-editor").val());currentContent=$("#content-editor").val()}}else{if($("#content-editor").html()!==currentContent){autosaveArticle($("#content-editor").html());currentContent=$("#content-editor").html()}}break;case"html-editor":if($("#html-editor").val()!==currentContent){if(typeof currentContent==="undefined"){currentContent=cmHtmlEditor.getValue()}if($("#html-editor").val()!==currentContent){autosaveArticle(cmHtmlEditor.getValue());currentContent=cmHtmlEditor.getValue()}}break;case"fullscreen-editor":if($("#html-editor").val()!==currentContent){if(typeof currentContent==="undefined"){currentContent=$("#fullscreen-editor").val()}if($("#html-editor").val()!==currentContent){autosaveArticle($("#fullscreen-editor").val());currentContent=$("#fullscreen-editor").val()}}break;case"fullscreen-html-editor":if($("#html-editor").val()!==currentContent){if(typeof currentContent==="undefined"){currentContent=$("#fullscreen-html-editor").val()}if($("#html-editor").val()!==currentContent){autosaveArticle(cmFullscreenHtmlEditor.getValue());currentContent=cmFullscreenHtmlEditor.getValue()}}break;default:break}})}$(document).on("click",".url-none",function(e){e.preventDefault();var id=this.id.replace("url-none-","");$("#link-url-"+id).val("")});$(document).on("click",".url-file",function(e){e.preventDefault();var id=this.id.replace("url-file-","");$.ajax({type:"POST",url:HTTP_ADMIN+"media",datatype:"json",data:"adminRequest="+encodeURIComponent(JSON.stringify({type:"media",action:"get-file-url",id:id,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);$("#link-url-"+id).val(response.urlFile)}})});$("#toolbar-edit, #action-edit-article").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noArticleError)}else{CMS.submitButton("article","edit")}});$("#toolbar-publish, #action-publish-article").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noArticleError)}else{CMS.submitButton("article","publish")}});$("#toolbar-unpublish, #action-unpublish-article").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noArticleError)}else{CMS.submitButton("article","unpublish")}});$("#toolbar-feature, #action-feature-article").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noArticleError)}else{CMS.submitButton("article","featured")}});$("#toolbar-nofeature, #action-nofeature-article").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noArticleError)}else{CMS.submitButton("article","remove-featured")}});$("#toolbar-delete, #action-delete-article").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noArticleError)}else{CMS.submitButton("article","delete")}});$(".quick-publish-article").click(function(){$("#article-state").val(1);CMS.submitButton("article","save-close")});$(".draft-article-content").click(function(){$("#article-state").val(2);CMS.submitButton("article","save")});$("#toolbar-save-article, #action-save-article").click(function(){CMS.submitButton("article","save")});$("#toolbar-save-new-article, #action-save-new-article").click(function(){CMS.submitButton("article","save-new")});$("#toolbar-save-close-article, #action-save-close-article").click(function(){selectNavItem("#articles-link","#new-article-link");CMS.submitButton("article","save-close")});$("#toolbar-close-article, #action-close-article").click(function(){selectNavItem("#articles-link","#new-article-link");window.location.href=HTTP_ADMIN+"articles"});$("#submit-article-globals").click(function(e){e.preventDefault();var allowComments,showIntroText,disableTinymce;allowComments=$("#allow-comments").is(":checked")?1:0;showIntroText=$("#show-intro-text").is(":checked")?1:0;$.ajax({type:"POST",url:HTTP_ADMIN+"articles",datatype:"json",data:"adminRequest="+encodeURIComponent(JSON.stringify({type:"article",action:"update-globals",allowComments:allowComments,showIntroText:showIntroText,deletedCommentText:$("#deleted-comment-text").val(),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){response=JSON.parse(data);$("#link-url-"+id).val(response.urlFile)}})});$("#toolbar-compare-revisions, #action-compare-revisions").click(function(){CMS.submitButton("article-revision","compare")});$("#toolbar-restore-revision, #action-restore-revision").click(function(){if(boxesChecked==0){alert(noRevisionError)}else{CMS.submitButton("article-revision","restore")}});$("#toolbar-delete-revision, #action-delete-revision").click(function(){if(boxesChecked==0){alert(noRevisionError)}else{CMS.submitButton("article-revision","delete")}})});function autosaveArticle(content){var action="autosave",checkedCategories="";if(checkedCategories){$("#all-category-tabs input[name='articleCategories[]']:checked:enabled").each(function(){checkedCategories.push($(this).val())})}if($("#id").length!==0){idForArticle=$("#id").val();action="revision"}if(typeof idForArticle==="undefined"){idForArticle=""}if(typeof revisionId==="undefined"){revisionId=""}$.ajax({type:"POST",url:HTTP_ADMIN+"articles",datatype:"json",data:"adminRequest="+encodeURIComponent(JSON.stringify({type:"article",action:action,id:idForArticle,title:$("#title").val(),alias:$("#alias").val(),author:$("#author").val(),datePosted:$("#date-posted").val(),content:content,summary:$("#summary-editor").html(),image:$("#img").val(),imageAlt:$("#img-alt").val(),imagePath:$("#img-path").val(),categories:checkedCategories,featured:$("#featured").val(),contentFormatId:$("#content-format").val(),metaDescription:$("#metaDescription").val(),metaKeywords:$("#metaKeywords").val(),metaAuthor:$("#metaAuthor").val(),metaRobots:$("#metaRobots").val(),revisionId:revisionId,authorUsername:$("#author option:selected").text(),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);idForArticle=response.id;if(response.action==="autosave"&&typeof response.errors==="undefined"){$("#adminForm").prepend('<input type="hidden" id="'+response.id+'" name="id" value="'+response.id+'" />');$("#autosave").html("Draft saved on "+response.lastSave);$("#autosave").effect("highlight",{},2e3,function(){})}else if(response.action==="revision"){revisionId=response.revisionId;$("#autosave").html("Revision by "+response.authorUsername+" saved on "+response.lastSave);$("#autosave").effect("highlight",{},2e3,function(){})}}})}