$(document).ready(function(){var noPageError="No pages were selected. \n\nPlease select an page from the table below and try again.",noRevisionError="No revisions selected, please select a revision from the table below and try again.";if($("#date-created").length!==0){$("#date-created").datetimepicker({showOn:"both",buttonImage:HTTP_IMAGE+"icons/admin/calendar_icon2.png",buttonImageOnly:true,ampm:true,dateFormat:"yy-mm-dd",timeFormat:"hh:mm TT"})}$("#toolbar-edit, #action-edit-page").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noPageError)}else{CMS.submitButton("page","edit")}});$("#toolbar-publish-page, #action-publish-page").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noPageError)}else{CMS.submitButton("page","publish")}});$("#toolbar-unpublish-page, #action-unpublish-page").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noPageError)}else{CMS.submitButton("page","unpublish")}});$("#toolbar-delete-page, #action-delete-page").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noPageError)}else{CMS.submitButton("page","delete")}});$(".quick-publish-page").click(function(){$("#page-state").val(1);CMS.submitButton("page","save-close")});$(".draft-page-content").click(function(){$("#page-state").val(2);CMS.submitButton("page","save")});$("#toolbar-save-page, #action-save-page").click(function(){CMS.submitButton("page","save")});$("#toolbar-save-new-page, #action-save-new-page").click(function(){CMS.submitButton("page","save-new")});$("#toolbar-save-close-page, #action-save-close-page").click(function(){selectNavItem("#pages-link","#new-page-link");CMS.submitButton("page","save-close")});$("#toolbar-close-page, #action-close-page").click(function(){selectNavItem("#pages-link","#new-page-link");window.location.href=HTTP_ADMIN+"pages"});$("#toolbar-delete-page-template, #action-delete-page-template").click(function(){if(typeof boxesChecked==="undefined"||boxesChecked==0){alert(noPageError)}else{CMS.submitButton("page-template","delete")}});$("#toolbar-save-page-template, #action-save-page-template").click(function(){CMS.submitButton("page-template","save")});$("#toolbar-save-new-page-template, #action-save-new-page-template").click(function(){CMS.submitButton("page-template","save-new")});$("#toolbar-save-close-page-template, #action-save-close-page-template").click(function(){CMS.submitButton("page-template","save-close")});$("#toolbar-close-page-template, #action-close-page-template").click(function(){window.location.href=HTTP_ADMIN+"pages/templates"});$("#toolbar-compare-revisions, #action-compare-revisions").click(function(){CMS.submitButton("page-revision","compare")});$("#toolbar-restore-revision, #action-restore-revision").click(function(){if(boxesChecked==0){alert(noRevisionError)}else{CMS.submitButton("page-revision","restore")}});$("#toolbar-delete-revision, #action-delete-revision").click(function(){if(boxesChecked==0){alert(noRevisionError)}else{CMS.submitButton("page-revision","delete")}});$("#add-page-template").click(function(e){e.preventDefault();$.ajax({url:HTTP_ADMIN+"pages",type:"POST",datatype:"json",data:"adminRequest="+encodeURIComponent(JSON.stringify({type:"page",action:"add-template",name:$("#template-name").val(),alias:$("#template-alias").val(),description:$("#template-desc").val(),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){response=JSON.parse(data);if(response.description===false){response.description=""}$("#page-templates > tbody").append('<tr id="overview-row-'+response.id+'">'+"<td>"+'<input id="cb-'+response.id+'" type="checkbox" class="overview-check" name="pageTemplateCheck[]" value="'+response.id+'" />'+"</td>"+'<td class="left">'+'<a href="'+HTTP_ADMIN+"pages/templates/"+response.id+'">'+response.name+"</a>"+"</td>"+"<td>"+response.alias+"</td>"+'<td class="left">'+response.description+"</td>"+"<td>"+response.id+"</td>"+"</tr>");$("#overview-row-"+response.id).effect("highlight","#CBC825",1e3);$("#template-name, #template-alias, #template-desc").val("");$("#no-templates-placeholder").hide()}})});if($("#content-editor").length!==0){var currentContent,idForPage="",autoSave=false,newIdInput,newIdAdjacent;autoSave=true;$(document).everyTime(3e4,function(){switch(activeEditor){case"content-editor":if(typeof currentContent==="undefined"){currentContent=$("#content-editor").html()}if($("#content-editor").html()!==currentContent){autosavePage($("#content-editor").html());currentContent=$("#content-editor").html()}break;case"html-editor":if($("#html-editor").val()!==currentContent){if(typeof currentContent==="undefined"){currentContent=$("#html-editor").val()}if($("#html-editor").val()!==currentContent){autosavePage($("#html-editor").val());currentContent=$("#html-editor").val()}}break;case"fullscreen-editor":if($("#html-editor").val()!==currentContent){if(typeof currentContent==="undefined"){currentContent=$("#fullscreen-editor").val()}if($("#html-editor").val()!==currentContent){autosavePage($("#fullscreen-editor").val());currentContent=$("#fullscreen-editor").val()}}break;case"fullscreen-html-editor":if($("#html-editor").val()!==currentContent){if(typeof currentContent==="undefined"){currentContent=$("#fullscreen-html-editor").val()}if($("#html-editor").val()!==currentContent){autosavePage($("#fullscreen-html-editor").val());currentContent=$("#fullscreen-html-editor").val()}}break;default:break}})}});function autosavePage(body){var action="autosave";if($("#id").length!==0){idForPage=$("#id").val();action="revision"}if(typeof idForPage==="undefined"){idForPage=""}if(typeof revisionId==="undefined"){revisionId=""}$.ajax({type:"POST",url:HTTP_ADMIN+"pages",datatype:"json",data:"adminRequest="+encodeURIComponent(JSON.stringify({type:"page",action:action,id:idForPage,page:$("#title").val(),title:$("#page-title").val(),alias:$("#alias").val(),author:$("#author").val(),datePosted:$("#date-created").val(),body:body,head:$("#page-head-editor").html(),contentFormatId:$("#content-format").val(),template:$("#template").val(),metaDescription:$("#metaDescription").val(),metaKeywords:$("#metaKeywords").val(),metaAuthor:$("#metaAuthor").val(),metaRobots:$("#metaRobots").val(),revisionId:revisionId,authorUsername:$("#author option:selected").text(),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);idForPage=response.id;if(response.action==="autosave"&&typeof response.errors==="undefined"){$("#adminForm").prepend('<input type="hidden" id="'+response.id+'" name="id" value="'+response.id+'" />');$("#autosave").html("Draft saved on "+response.lastSave);$("#autosave").effect("highlight",{},2e3,function(){})}else if(response.action==="revision"){revisionId=response.revisionId;$("#autosave").html("Revision by "+response.authorUsername+" saved on "+response.lastSave);$("#autosave").effect("highlight",{},2e3,function(){})}}})}