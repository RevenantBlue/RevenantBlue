var numOfRoots=0,numOfChildren=[];$(document).ready(function(){var editor,postId,moveTopicId,order,sort,waypointOptions,permalinkWaypointOptions,prevPost,currentPost,nextPost,lastDir,cpanelTabs,uploader,autoloadTopicsInProgress=false,autoloadPostsInProgress,lastScrollTop=0;if($("#forum-editor").length!==0){$("#forum-editor").ckeditor({contentsCss:HTTP_SERVER+"site/view/css/forum-cke.css",height:192,forcePasteAsPlainText:true,disableNativeSpellChecker:false,removePlugins:"contextmenu,liststyle,tabletools",allowedContent:{"b i ul ol strong em u s sub sup":true,"h1 h2 h3 p blockquote li a object div":{styles:"text-align"},p:{attributes:"class",classes:"quote-citation"},a:{attributes:"href,target,class",classes:"ui-icon,ui-icon-arrowreturnthick-1-w"},img:{attributes:"src,alt",styles:"width,height",classes:"left,right"},iframe:{attributes:"width,height,src,allowfullscreen,frameborder,title"}}})}if($("#forum-editor").length!==0){var editor=CKEDITOR.instances["forum-editor"],dragStartOutside=true;editor.on("instanceReady",function(ev){$(".cke_resizer").remove();ev.editor.document.on("dragstart",function(ev){dragStartOutside=false});ev.editor.document.on("drop",function(ev){if(dragStartOutside){ev.data.preventDefault(true)}dragStartOutside=true})})}if(typeof forumList!=="undefined"){buildForum(forumList,false,function(){$("#forum").show()})}if(typeof subForumList!=="undefined"){buildForum(subForumList,false,function(){if($("#forum").length!==0){$("#forum").show()}})}if($("#forum-tabs").length!==0){$("#forum-tabs").tabs({activate:function(e,ui){if(ui.newPanel.prop("id")!=="std-forum"){window.location.hash=ui.newPanel.prop("id")}else{window.location.hash=""}}})}if(typeof url!=="undefined"&&typeof(url.segment(5)!=="undefined")&&$("#forum-posts").length!==0){postId=url.segment("5");if($("#post-"+postId).length!==0){window.setTimeout(function(){$(window).scrollTop($("#post-"+postId).position().top)},150)}}$(document).mouseup(function(e){var modWrap=$(".mod-opts-wrap");if(!modWrap.is(e.target)&&modWrap.has(e.target).length===0){$(".mod-options").hide()}});$("#create-forum-topic").click(function(e){e.preventDefault();$("#topic-panel").slideToggle()});$("#cancel-topic").click(function(e){e.preventDefault();$("#topic-panel").slideToggle()});$(".create-forum-post").click(function(e){e.preventDefault();$("#post-panel").slideToggle();editor.focus()});$("#cancel-post").click(function(e){e.preventDefault();if($("#update-post").is(":visible")){$("#submit-post").show();$("#update-post").hide();$("#post-id").val("")}$("#post-panel").slideToggle()});$("#main-content").on("click",".fav-stars",function(e){var id=$(this).prop("id").replace("fav-",""),action;if($("#fav-"+id+" > span").hasClass("favorited")){action="remove-favorite"}else{action="favorite"}$("#fav-"+id+" > .fav-star").removeClass("no-hover");$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:action,topicId:id,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){response=JSON.parse(data);if(response.error){alert(response.error)}else{if(action==="favorite"){$("#fav-"+id+" > .fav-star").addClass("favorited no-hover")}else{$("#fav-"+id+" > .fav-star").removeClass("favorited").addClass("no-hover")}}}})});$(".fav-stars").on("mouseout",function(e){$(".fav-stars > .fav-star").removeClass("no-hover")});$("#forum-topics, .forum-topics").on("click",".mod-opts-wrap",function(e){e.preventDefault();var id=$(this).prop("id").replace("mod-opts-wrap-","");$(".mod-options").not($("#mod-options-"+id)).hide();if($("#mod-options-"+id).is(":visible")){$("#mod-options-"+id).hide()}else{$("#mod-options-"+id).show()}});$("#forum-topics, .forum-topics").on("mouseover",".topic-row",function(e){var topicId=$(this).prop("id").replace("topic-","");$("#mod-opts-wrap-"+topicId).fadeIn("fast",function(){})});$("#forum-topics, .forum-topics").on("mouseleave",".topic-row",function(e){var topicId=$(this).prop("id").replace("topic-","");if(!$("#mod-options-"+topicId).is(":visible")){$("#mod-opts-wrap-"+topicId).fadeOut("fast",function(){})}});$("#forum-topics, .forum-topics").on("click",".edit-topics",function(e){var topicId=$(this).prop("id").replace("edit-topic-",""),currentTitle;e.preventDefault();currentTitle=$("#topic-title-"+topicId+" > h4 > a").html();if($("#edit-topic-title-"+topicId).length===0){$("#topic-title-"+topicId+" > h4").hide().before('<div id="edit-title-wrap-'+topicId+'" class="edit-title-wrap">'+'<div class="inner">'+'<input type="text" id="edit-topic-title-'+topicId+'" class="edit-forum-title" value="'+$.trim(currentTitle)+'" />'+'<span id="update-topic-title-'+topicId+'" class="update-topic-title">Update</span>'+"</div>"+"</div>")}else{$("#edit-title-wrap-"+topicId).remove();$("#topic-title-"+topicId+" > h4").show();$("#topic-title-"+topicId+" > h4 > a").html(response.title)}});$("#forum-topics, .forum-topics").on("click",".update-topic-title",function(e){var topicId=$(this).prop("id").replace("update-topic-title-",""),currentTitle;$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"update-topic-title",forumId:RB.forum.forumId,topicId:topicId,title:$("#edit-topic-title-"+topicId).val(),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);if(response.titleUpdated){$("#edit-title-wrap-"+response.topicId).remove();$("#topic-title-"+response.topicId+" > h4").show();$("#topic-title-"+response.topicId+" > h4 > a").html(response.title)}}})});$("#forum-topics, .forum-topics").on("click",".pin-topics",function(e){var topicId=$(this).prop("id").replace("pin-topic-","");e.preventDefault();$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"pin-topic",forumId:RB.forum.forumId,topicId:topicId,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);$("#topic-tags-"+topicId).prepend('<span id="pinned-'+response.topicId+'" class="forum-tags pinned">Pinned</span>');$("#pin-topic-"+topicId).remove();$("#edit-topic-"+topicId).after('<li id="unpin-topic-'+response.topicId+'" class="unpin-topics">'+'<a href="#">'+"Unpin"+"</a>"+'<span class="sprites unpin"></span>'+"</li>")}})});$("#forum-topics, .forum-topics").on("click",".unpin-topics",function(e){var topicId=$(this).prop("id").replace("unpin-topic-","");e.preventDefault();$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"unpin-topic",forumId:RB.forum.forumId,topicId:topicId,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);$("#pinned-"+topicId+", #unpin-topic-"+topicId).remove();$("#edit-topic-"+topicId).after('<li id="pin-topic-'+response.topicId+'" class="pin-topics">'+'<a href="#">'+"Pin"+"</a>"+'<span class="sprites pin"></span>'+"</li>")}})});$("#forum-topics, .forum-topics").on("click",".lock-topics",function(e){var topicId=$(this).prop("id").replace("lock-topic-","");e.preventDefault();$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"lock-topic",forumId:RB.forum.forumId,topicId:topicId,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);if($("#topic-lock-"+topicId).length===0){$("#fav-"+topicId).append('<span id="topic-lock-'+topicId+'" class="sprites locked"></span>');$("#lock-topic-"+topicId).hide();$("#unlock-topic-"+topicId).show()}}})});$("#forum-topics, .forum-topics").on("click",".unlock-topics",function(e){var topicId=$(this).prop("id").replace("unlock-topic-","");e.preventDefault();$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"unlock-topic",forumId:RB.forum.forumId,topicId:topicId,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);$("#topic-lock-"+topicId).remove();$("#unlock-topic-"+topicId).hide();$("#lock-topic-"+topicId).show()}})});$("#forum-topics, .forum-topics").on("click",".move-topics",function(e){moveTopicId=$(this).prop("id").replace("move-topic-","");e.preventDefault();$("#move-topic-manager").dialog("option","title","Moving Topic: "+$("#topic-title-"+moveTopicId+" > h4 > a").text());$("#move-topic-manager").dialog("open")});$("#move-topic-manager").dialog({width:600,dialogClass:"move-topic-mgr-dialog",modal:true,autoOpen:false,open:function(){},close:function(){moveTopicId=null},buttons:[{text:"Move Topic",id:"move-topic","class":"rb-btn blue-btn",click:function(){$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"move-topic",forumId:RB.forum.forumId,topicId:moveTopicId,moveTo:$("#move-to-forum").val(),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);if(response.topicMoved){$("#topic-"+response.topicId).fadeOut("slow",function(){$("#topic-"+response.topicId).remove()});$("#move-topic-manager").dialog("close")}}})}},{text:"Close","class":"rb-btn light-gray-btn",click:function(){$(this).dialog("close")}}]});$("#forum-topics, .forum-topics").on("click",".delete-topics",function(e){var topicId=$(this).prop("id").replace("delete-topic-",""),confirmDelete;e.preventDefault();confirmDelete=confirm("Are you sure you want to delete this topic and all of its replies?");if(confirmDelete){$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"delete-topic",forumId:RB.forum.forumId,topicId:topicId,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);if(response.topicDeleted){$("#topic-"+response.topicId).fadeOut("slow",function(){$("#topic-"+response.topicId).remove()})}}})}});$("#submit-topic").click(function(e){e.preventDefault();var title=$("#poll-title").val(),choices=[];$("#main-form-action").val("post-topic");if(!title){$("#main-form").submit();return}$(".poll-choice").each(function(e){choices.push($(this).val())});$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"insert-poll",title:title,choices:choices,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);$("#poll-id").val(response.pollId)}}).done(function(){$("#main-form").submit()})});$("#toggle-preview").click(function(e){if($("#editor-preview-wrap").is(":visible")){$("#editor-preview-wrap").hide();$("#editor-wrap").css({width:"100%"});$("#toggle-preview").html("Show Preview")}else{$("#editor-preview-wrap").show();$("#editor-wrap").css({width:""});$("#toggle-preview").html("Hide Preview")}});$("#topic-options-toggle").click(function(e){$("#topic-extras").toggle("slide",{direction:"right"})});if($("#forum-editor").length!==0){var editor=$("#forum-editor").ckeditor().editor;if(editor){editor.on("change",function(){var editorContent=$("#forum-editor").val();$("#editor-preview").html(editorContent)})}}if($("#topic-panel").length!==0){$("#topic-panel").resizable({minHeight:255,handles:"n",start:function(e,ui){},resize:function(e,ui){$("#topic-panel").height(ui.size.height);$("#editor-preview").css("width","");$("#topic-panel").css({top:"",bottom:0})},stop:function(e,ui){},alsoResize:"#cke_forum-editor > .cke_inner > .cke_contents, #editor-preview, #editors"})}if($("#post-panel").length!==0){$("#post-panel").resizable({minHeight:255,handles:"n",start:function(e,ui){},resize:function(e,ui){$("#post-panel").height(ui.size.height);$("#editor-preview").css("width","");$("#post-panel").css({top:"",bottom:0})},stop:function(e,ui){},alsoResize:"#cke_forum-editor, .cke_inner > .cke_contents, #editor-preview, #editors"})}$("#open-poll-mgr").click(function(e){e.preventDefault();$("#poll-manager").dialog("open")});$("#poll-manager").dialog({title:"Poll Manager",width:800,dialogClass:"poll-mgr-dialog",modal:true,autoOpen:false,open:function(){},buttons:[{text:"Save Poll",id:"save-poll","class":"rb-btn blue-btn",click:function(){$(this).dialog("close")}},{text:"Add Choice",id:"add-poll-choice","class":"rb-btn light-gray-btn",click:function(){$("#poll-choices").append('<div class="poll-choice-wrap clearfix">'+'<input type="text" class="poll-choice large-text fltlft">'+'<a class="poll-choice-del" href="#">Delete</a>'+"</div>");$(".poll-choice-wrap:last-child > .poll-choice").focus()}},{text:"Close","class":"rb-btn light-gray-btn",click:function(){$(this).dialog("close")}}]});$(".poll-choice-wrap").on("click",".poll-choice-del",function(e){e.preventDefault();$(this).parent().fadeOut("fast",function(){$(this).remove()})});$("#poll-vote").click(function(e){e.preventDefault();var choiceId=$(".poll-choice:checked").val(),pollId=$("#poll-id").val();$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"vote",pollId:pollId,choiceId:choiceId,topicId:$("#topic-id").val(),forumId:$("#forum-id").val(),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);$("#poll-id").val(response.pollId);if(typeof response.voted!=="undefined"){$("#forum-poll-choices, #poll-vote, #poll-view-results").hide();$("#forum-poll-results").show();buildPoll(JSON.parse(response.poll))}}})});$("#poll-view-results").click(function(e){e.preventDefault();if($("#forum-poll-choices").is(":visible")){if($("#poll-vote").is(":visible")){$("#poll-view-results").button("option","label","Back to voting")}$("#forum-poll-choices").hide();$("#forum-poll-results").show()}else{if($("#poll-vote").is(":visible")){$("#poll-view-results").button("option","label","View Results")}$("#forum-poll-choices").show();$("#forum-poll-results").hide()}});$("#load-more-topics").click(function(e){e.preventDefault();if(RB.forum.topicLimit+RB.forum.topicOffset<RB.forum.numOfTopics){RB.forum.topicOffset+=RB.forum.topicLimit;$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"load-more-topics",forumId:RB.forum.forumId,limit:RB.forum.topicLimit,offset:RB.forum.topicOffset,order:url.param("order"),sort:url.param("sort"),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){loadTopics(data,paginateTopics)}})}});if($("#forum-topics").length!==0){window.setTimeout(function(){$(document).scrollTop(0)},100);if(typeof localStorage!=="undefined"){if(typeof localStorage.autoloadTopics!=="undefined"){if(localStorage.autoloadTopics=="true"){RB.forum.autoloadTopics=true;$("#autoload-topics-toggle").removeClass("toggle-off").addClass("toggle-on").text("on")}else if(localStorage.autoloadTopics=="false"){RB.forum.autoloadTopics=false;$("#autoload-topics-toggle").removeClass("toggle-on").addClass("toggle-off").text("off")}}else{localStorage.autoloadTopics="true";RB.forum.autloadTopics=true;$("#autoload-topics-toggle").removeClass("toggle-off").addClass("toggle-on").text("on")}}else{RB.forum.autoloadTopics=true;$("#autoload-topics-toggle").removeClass("toggle-off").addClass("toggle-on").text("on")}$("#main-form").validate({rules:{title:{required:true,minlength:2}},messages:{title:{required:"Please provide a title for your topic",minlength:$.validator.format("Enter at least {0} characters")}}});order=$.url(window.location.href).param("order");switch(order){case"last_reply_date":$("#order-by-activity").addClass("selected");break;case"date_posted":$("#order-by-date").addClass("selected");break;case"num_of_posts":$("#order-by-replies").addClass("selected");break;case"num_of_views":$("#order-by-views").addClass("selected");break;default:$("#topic-order-options li").removeClass("selected");$("#sort-by-activity").addClass("selected");$("#order-by-activity").addClass("selected");break}waypointOptions={offset:"80%"};$("#load-more-topics").waypoint(function(e,direction){if(RB.forum.topicLimit<=RB.forum.numOfTopics&&RB.forum.autoloadTopics&&autoloadTopicsInProgress===false){autoloadTopicsInProgress=true;$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"load-more-topics",forumId:RB.forum.forumId,limit:RB.forum.topicLimit,offset:RB.forum.topicOffset,order:url.param("order"),sort:url.param("sort"),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);if(RB.forum.topicLimit<=RB.forum.numOfTopics){loadTopics(data,paginateTopics)}else{$("#load-more-topics").waypoint("disable");$("#load-more-topics").hide()}if(response.noMoreTopics){$("#load-more-topics").waypoint("disable");$("#load-more-topics").hide()}$.waypoints("refresh");RB.forum.topicOffset+=parseInt(RB.forum.topicLimit,10);autoloadTopicsInProgress=false}})}},waypointOptions);paginateTopics()}$("#autoload-topics-toggle").click(function(e){var autoloadOn=$(this).hasClass("toggle-on");if(autoloadOn){$(this).removeClass("toggle-on").addClass("toggle-off").text("off");RB.forum.autoloadTopics=false;if(typeof localStorage!=="undefined"){localStorage.autoloadTopics=false}}else{$(this).removeClass("toggle-off").addClass("toggle-on").text("on");RB.forum.autoloadTopics=true;if(typeof localStorage!=="undefined"){localStorage.autoloadTopics=true}}});$("#order-by-activity").click(function(e){var topicUrl=buildTopicUrl("last_reply_date","desc");window.location.href=topicUrl;return false});$("#order-by-date").click(function(e){var topicUrl=buildTopicUrl("date_posted","desc");window.location.href=topicUrl;return false});$("#order-by-replies").click(function(e){var topicUrl=buildTopicUrl("num_of_posts","desc");window.location.href=topicUrl;return false});$("#order-by-views").click(function(e){var topicUrl=buildTopicUrl("num_of_views","desc");window.location.href=topicUrl;return false});$("#forum-posts").on("click",".post-menu-report",function(e){var id=$(this).prop("id").replace("report-post-",""),reported=$(this).hasClass("reported");if(reported){$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"unreport-post",postId:id,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);if(typeof response.error!=="undefined"){alert(response.error)}else{$("#report-post-"+id).text("Report").removeClass("reported")}}})}else{$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"report-post",postId:id,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);if(typeof response.error!=="undefined"){alert(response.error)}else{$("#report-post-"+id).text("Reported").addClass("reported")}}})}});$("#forum-posts").on("click",".post-menu-edit",function(e){var id=$(this).prop("id").replace("edit-post-",""),postContent;postContent=$("#post-content-"+id).html();$("#submit-post").hide();$("#update-post").show();$("#post-id").val(id);$("#post-panel").slideDown();$("#forum-editor").val(postContent);$("#editor-preview").html(postContent)});$("#forum-posts").on("click",".post-menu-delete",function(){var id=$(this).prop("id").replace("delete-post-",""),userId=$("#post-"+id+"-userid").val();$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"delete-post",forumId:$("#forum-id").val(),topicId:$("#topic-id").val(),postId:id,userId:userId,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data),userPostCount=parseInt($(".post-count-for-"+response.userId).html());$("#post-"+response.postId).fadeOut(1300,function(){var totalPosts,currentPost,deletedPostNum,postId;deletedPostNum=parseInt($("#post-permalink-"+response.postId).text().replace("#",""));$("#post-"+response.postId).remove();$(".post-count-for-"+response.userId).html(userPostCount-1);totalPosts=parseInt($("#total-posts").text());currentPost=parseInt($("#current-post").text());if(currentPost===totalPosts){currentPost-=1;$("#current-post").text(currentPost)}if(deletedPostNum!==totalPosts){for(x=deletedPostNum;x<=totalPosts;x++){postId=$("#post-number-"+x).val();var newPostNum=x-1;$("#post-permalink-"+postId).text("#"+newPostNum);$("#post-number-"+x).prop("id","post-number-"+newPostNum);deletedPostNum++}}totalPosts-=1;$("#total-posts").text(totalPosts);bindPostWaypointPermalink();bindPostWaypointFooter()})}})});$("#forum-posts").on("click",".post-menu-quote",function(){var id=$(this).prop("id").replace("quote-post-",""),quotedUser,quotedPost,quoteURL,currentEditorHTML;quotedUser=$("#username-for-post-"+id).html();quoteURL=$("#post-permalink-"+id).prop("href");quotedPost='<p class="quote-citation">'+'<a href="'+quoteURL+'" class="ui-icon ui-icon-arrowreturnthick-1-w">&nbsp;</a>'+quotedUser+" said:"+"</p>"+"<blockquote>"+$("#post-content-"+id).html()+"</blockquote>"+"<p> </p>";quotedPost=quotedPost.replace("<p>&nbsp;</p>","");quotedPost=quotedPost.replace("<p></p>","");currentEditorHTML=$("#forum-editor").val();$("#post-panel").slideDown();$("#forum-editor").val(currentEditorHTML+"\n"+quotedPost);$("#editor-preview").html(currentEditorHTML+"\n"+quotedPost)});$("#forum-posts").on("click",".post-menu-best-answer",function(){var id=$(this).prop("id").replace("best-answer-post-",""),prevId;if($(".best-answer").length!==0){prevId=$(".best-answer").prop("id").replace("best-answer-","")}$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"best-answer-post",prevId:prevId,id:id,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){$("#best-answer-"+prevId).remove();$("#quote-post-"+prevId).after('<li id="best-answer-post-'+prevId+'" class="post-menu-best-answer">'+'<span class="ui-icon ui-icon-check"></span>'+"<span>Best Answer</span>"+"</li>");$("#posted-info-"+id).after('<p id="best-answer-'+id+'" class="best-answer">'+'<span class="ui-icon ui-icon-check"></span>'+"<span>Best Answer</span>"+"</p>");$("#best-answer-post-"+id).remove()}})});if($("#forum-posts").length!==0){if(typeof localStorage!=="undefined"){if(typeof localStorage.autoloadPosts!=="undefined"){if(localStorage.autoloadPosts=="true"){autoloadPosts=true;$("#autoload-posts-toggle").removeClass("toggle-off").addClass("toggle-on").text("on")}else if(localStorage.autoloadPosts=="false"){autoloadPosts=false;$("#autoload-posts-toggle").removeClass("toggle-on").addClass("toggle-off").text("off")}}else{localStorage.autoloadPosts="true";autoloadPosts=true;$("#autoload-posts-toggle").removeClass("toggle-off").addClass("toggle-on").text("on")}}else{autloadPosts=true;$("#autoload-posts-toggle").removeClass("toggle-off").addClass("toggle-on").text("on")}if(!$("#current-post").text()){$("#current-post").text($("#forum-posts > .post-wrap:first > .inner > .post > .post-head > .post-permalink > a").text().replace("#",""));setPostScrollerProgress($("#forum-posts > .post-wrap:first > .inner > .post > .post-head > .post-permalink > a").text().replace("#",""))}$("#autoload-posts-toggle").click(function(e){var autoloadOn=$(this).hasClass("toggle-on");if(autoloadOn){$(this).removeClass("toggle-on").addClass("toggle-off").text("off");autoloadPosts=false;if(typeof localStorage!=="undefined"){localStorage.autoloadPosts=false}}else{$(this).removeClass("toggle-off").addClass("toggle-on").text("on");autoloadPosts=true;if(typeof localStorage!=="undefined"){localStorage.autoloadPosts=true}}console.log(localStorage.autoloadPosts)});$("#post-scroller").hide();window.setTimeout(function(){$(document).scrollTop(0)},100);window.setTimeout(function(){bindPostWaypointPermalink();bindPostWaypointFooter();bindPostWaypointScrollUp();bindPostWaypointScrollDown();$("#post-scroller").show()},1e3);$("#main-inner").waypoint(function(direction){if(direction==="up"){$("#current-post").text(1)}});$(".end-of-forum").waypoint(function(direction){if(direction==="down"){$("#post-scroller").css({position:"absolute"})}else if(direction==="up"){$("#post-scroller").css({position:"",bottom:""})}},{offset:"100%"})}if($("#forum-profile-menu").length!==0){$("#forum-profile-menu").tabs({activate:function(e,ui){window.location.hash=ui.newPanel.prop("id")}}).addClass("ui-tabs-vertical ui-helper-clearfix");$("#forum-profile-menu li").removeClass("ui-corner-top").addClass("ui-corner-left");$("#edit-my-profile").click(function(e){e.preventDefault();window.location.href=HTTP_SERVER+"cpanel"});$("#open-messenger").click(function(e){var sendToId;e.preventDefault();if($("#friend-id").length!==0){sendToId=$("#friend-id").val()}window.location.href=HTTP_SERVER+"cpanel/messenger?sendTo="+sendToId});$("#add-friend").click(function(e){e.preventDefault();var confirmRequest;$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"add-friend",friendId:$("#friend-id").val(),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){response=JSON.parse(data);if(typeof response.friendAdded!=="undefined"){$("#add-friend, #remove-friend").toggle();if($("#forum-profile-friends").length!==0&&$("#user-recent-friends").length!==0){$("#no-friends, #no-recent-friends").hide();$("#user-recent-friends > .element-body").prepend('<div id="recent-friend-'+response.userId+'" class="recent-friend">'+'<a href="'+HTTP_FORUM+"user/"+response.userAlias+"/"+response.userId+'">'+"</a>"+"</div>").hide().fadeIn(2e3);$("#forum-profile-friends > .inner").prepend('<div class="friend" id="friend-'+response.userId+'">'+'<a id="friend-avatar-'+response.userId+'" class="friend-avatar" href="'+HTTP_FORUM+"user/"+response.userAlias+"/"+response.userId+'">'+"</a>"+'<a href="#">'+response.username+"</a>"+"</div>").hide().fadeIn(2e3);if(typeof response.avatar!=="undefined"&&typeof(response.avatarSmall!=="undefined")){$("#recent-friend-"+response.userId+" > a").append('<img title="'+response.username+'" alt="'+response.username+'" src="'+HTTP_AVATARS+response.avatarSmall+'" />');$("#friend-avatar-"+response.userId).append('<img title="'+response.username+'" alt="'+response.username+'" src="'+HTTP_AVATARS+response.avatar+'" />')}else if(defaultAvatar&&defaultAvatarSmall){$("#recent-friend-"+response.userId+" > a").append('<img title="'+response.username+'" alt="'+response.username+'" src="'+defaultAvatarSmall+'" />');$("#friend-avatar-"+response.userId).append('<img title="'+response.username+'" alt="'+response.username+'" src="'+defaultAvatar+'" />')}else{$("#recent-friend-"+response.userId+" > a").append('<div class="no-avatar-small">'+'<div class="inner">'+"NA"+"</div>"+"</div>");$("#friend-avatar-"+response.userId).append('<div class="no-avatar">'+'<div class="inner">'+"<span>No Avatar</span>"+"</div>"+"</div>")}}}else if(typeof response.friendRequest!=="undefined"){alert("Friend request sent!")}}})});$("#remove-friend").click(function(e){e.preventDefault();$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"remove-friend",friendId:$("#friend-id").val(),csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){response=JSON.parse(data);if(typeof response.friendRemoved!=="undefined"&&response.friendRemoved){$("#add-friend, #remove-friend").toggle()}$("#recent-friend-"+response.userId).fadeOut("slow",function(){$(this).remove();if($("#user-recent-friends > .element-body").children().length===1){$("#no-friends, #no-recent-friends").show()}});$("#friend-"+response.userId).fadeOut("slow",function(){$(this).remove()})}})});$("#forum-profile-posts").on("click","#load-more-user-posts",function(e){$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"load-more-user-posts",offset:postsOffset,userId:profileUserId,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var res=JSON.parse(data),post,i;for(i=0;i<res.userPosts.length;i+=1){post='<div class="user-post">'+'<div class="user-post-topic">'+'<a href="'+HTTP_FORUM+"topic/"+res.userPosts[i]["topic_alias"]+"/"+res.userPosts[i]["topic_id"]+"/"+res.userPosts[i]["id"]+'">'+"In Topic: "+res.userPosts[i]["topic_title"]+"</a>"+"</div>"+"<div>"+'<div class="user-post-date">'+"Posted "+res.userPosts[i]["date_posted"]+"</div>"+'<div class="post-content">'+res.userPosts[i]["post_content"]+"</div>"+"</div>"+"</div>";$("#forum-profile-posts > .inner > .user-post").last().after(post)}if(res.noMorePosts){$("#load-more-user-posts").hide()}postsOffset+=postsOffset}})});$("#forum-profile-topics").on("click","#load-more-user-topics",function(e){$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"load-more-user-topics",offset:topicsOffset,userId:profileUserId,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var res=JSON.parse(data),topic,i;for(i=0;i<res.userTopics.length;i+=1){topic='<div class="user-topic">'+'<a href="'+HTTP_FORUM+"topic/"+res.userTopics[i]["topic_alias"]+"/"+res.userTopics[i]["id"]+'">'+res.userTopics[i]["topic_title"]+"</a>"+'<div class="user-post-date">'+"Started "+res.userTopics[i]["date_posted"]+"</div>"+"</div>";$("#forum-profile-topics > .inner > .user-topic").last().after(topic)}if(res.noMoreTopics){$("#load-more-user-topics").hide()}topicsOffset+=topicsOffset}})})}});function buildTopicUrl(newOrder,newSort){var order,sort,currentUrl,topicUrl;order=$.url(window.location.href).param("order");sort=$.url(window.location.href).param("sort");if(order&&sort){topicUrl=window.location.href;topicUrl=topicUrl.replace(new RegExp(order,"g"),newOrder);topicUrl=topicUrl.replace(new RegExp(sort,"g"),newSort)}else{topicUrl=window.location.href+"?order="+newOrder+"&sort="+newSort}return topicUrl}function loadTopics(data,callback){var response=JSON.parse(data),favClass;if(response.noMoreTopics){$("#load-more-topics").fadeOut("slow")}for(x=0;x<response.topicList.length;x++){if($.inArray(response.topicList[x].id,RB.forum.favoriteTopics)!==-1){favClass="favorited"}else{favClass=""}$("#forum-topics > tbody:last").append('<tr id="topic-'+response.topicList[x].id+'" class="topic-row" style="display: none;" data-num-of-posts="'+response.topicList[x].num_of_posts+'" data-alias="'+response.topicList[x].topic_alias+'" data-paginated="false">'+'<td id="fav-'+response.topicList[x].id+'" class="fav-stars" title="Add/Remove favorite topic">'+'<span class="fav-star'+" "+favClass+'">'+"☆"+"</span>"+"</td>"+'<td id="topic-title-'+response.topicList[x].id+'" class="topic-title">'+"<h4>"+'<a href="'+HTTP_FORUM+"topic/"+response.topicList[x].topic_alias+"/"+response.topicList[x].id+'">'+response.topicList[x].topic_title+"</a>"+"</h4>"+"<p>"+"<span>Started by </span>"+'<a href="'+HTTP_SERVER+"forums/user/"+response.topicList[x].last_reply_username_alias+"/"+response.topicList[x].last_reply_user_id+'">'+response.topicList[x].username+"</a>"+"<span>, "+response.topicList[x].date_posted+"</span>"+"</p>"+"</td>"+'<td id="topic-tags-'+response.topicList[x].id+'" class="topic-tags">'+"</td>"+'<td class="topic-info">'+"<ul>"+"<li>"+"<span>"+response.topicList[x].num_of_posts+" replies"+"</span>"+"</li>"+"<li>"+"<span>"+response.topicList[x].num_of_views+" views</span>"+"</span>"+"</li>"+"</ul>"+"</td>"+'<td id="last-reply-column-'+response.topicList[x].id+'" class="topic-last-reply">'+'<div id="last-reply-avatar-'+response.topicList[x].id+'" class="last-reply-avatar fltlft">'+'<a href="'+HTTP_SERVER+"forums/user/"+response.topicList[x].last_reply_username_alias+"/"+response.topicList[x].last_reply_user_id+'">'+"</a>"+"</div>"+'<ul id="last-reply-info-'+response.topicList[x].id+'" class="last-reply-info">'+"</ul>"+"</td>"+"</tr>");
if(response.topicList[x].last_reply_username){if(response.topicList[x].avatar_small){$("#last-reply-avatar-"+response.topicList[x].id+" > a").append('<img src="'+HTTP_AVATARS+response.topicList[x].avatar_small+'" alt="'+response.topicList[x].last_reply_username+'" title="'+response.topicList[x].last_reply_username+'" />')}else if(typeof defaultAvatarSmall!=="undefined"){$("#last-reply-avatar-"+response.topicList[x].id+" > a").append('<img src="'+defaultAvatarSmall+'" alt="'+response.topicList[x].last_reply_username+'" title="'+response.topicList[x].last_reply_username+'" />')}else{$("#last-reply-avatar-"+response.topicList[x].id+" > a").append('<div class="no-avatar-small">'+'<div class="inner">'+"NA"+"</div>"+"</div>")}$("#last-reply-info-"+response.topicList[x].id).append("<li>"+'<a href="'+HTTP_SERVER+"forums/user/"+response.topicList[x].last_reply_username_alias+"/"+response.topicList[x].last_reply_user_id+'">'+response.topicList[x].last_reply_username+"</a>"+"</li>")}$("#last-reply-info-"+response.topicList[x].id).append("<li>"+"<span>"+response.topicList[x].last_reply_date+"</span>"+"</li>");if(response.topicList[x].pinned!=0){$("#topic-tags-"+response.topicList[x].id).prepend('<span id="pinned-'+response.topicList[x].id+'" class="forum-tags pinned">Pinned</span>')}if(typeof RB.forum.moderatorPerms!=="undefined"&&RB.forum.moderatorPerms){$("#last-reply-column-"+response.topicList[x].id).after('<td class="mod-column">'+'<div id="mod-opts-wrap-'+response.topicList[x].id+'" class="mod-opts-wrap" style="display: none;">'+'<div class="mod-option-icon sprites" title="Moderator Actions"></div>'+'<span class="arrow-down"></span>'+'<ul id="mod-options-'+response.topicList[x].id+'" style="display: none;" class="mod-options">'+"</ul>"+"</div>"+"</td>");if(RB.forum.moderatorPerms[response.topicList[x].forum_id].edit_topics==1){$("#mod-options-"+response.topicList[x].id).append('<li id="edit-topic-'+response.topicList[x].id+'" class="edit-topics">'+'<a href="#">'+"Edit title"+"</a>"+'<span class="ui-icon ui-icon-pencil"></span>'+"</li>")}if(RB.forum.moderatorPerms[response.topicList[x].forum_id].pin_topics==1){if(response.topicList[x].pinned==0){$("#mod-options-"+response.topicList[x].id).append('<li id="pin-topic-'+response.topicList[x].id+'" class="pin-topics">'+'<a href="#">'+"Pin"+"</a>"+'<span class="sprites pin"></span>'+"</li>")}else{$("#mod-options-"+response.topicList[x].id).append('<li id="unpin-topic-'+response.topicList[x].id+'" class="unpin-topics">'+'<a href="#">'+"Unpin"+"</a>"+'<span class="sprites unpin"></span>'+"</li>")}}if(RB.forum.moderatorPerms[response.topicList[x].forum_id].close_topics==1){$("#mod-options-"+response.topicList[x].id).append('<li id="lock-topic-'+response.topicList[x].id+'" class="lock-topics">'+'<a href="#">'+"Lock"+"</a>"+'<span class="ui-icon ui-icon-locked"></span>'+"</li>");$("#mod-options-"+response.topicList[x].id).append('<li id="unlock-topic-'+response.topicList[x].id+'" class="unlock-topics">'+'<a href="#">'+"Unlock"+"</a>"+'<span class="ui-icon ui-icon-unlocked"></span>'+"</li>");if(response.topicList[x].locked==0){$("#unlock-topic-"+response.topicList[x].id).hide()}else{$("#lock-topic"+response.topicList[x].id).hide()}}if(RB.forum.moderatorPerms[response.topicList[x].forum_id].move_topics==1){$("#mod-options-"+response.topicList[x].id).append('<li id="move-topic-'+response.topicList[x].id+'" class="move-topics">'+'<a href="#">'+"Move"+"</a>"+'<span class="ui-icon ui-icon-transferthick-e-w"></span>'+"</li>")}if(RB.forum.moderatorPerms[response.topicList[x].forum_id].toggle_topic_visibility==1){$("#mod-options-"+response.topicList[x].id).append('<li id="hide-topic-'+response.topicList[x].id+'" class="hide-topics">'+'<a href="#">'+"Hide"+"</a>"+'<span class="ui-icon ui-icon-radio-on"></span>'+"</li>")}if(RB.forum.moderatorPerms[response.topicList[x].forum_id].delete_topics==1){$("#mod-options-"+response.topicList[x].id).append('<li id="delete-topic-'+response.topicList[x].id+'" class="delete-topics"'+'<a href="#">'+"Delete"+"</a>"+'<span class="ui-icon ui-icon-trash"></span>'+"</li>")}}}for(x=0;x<response.topicList.length;x++){$("#topic-"+response.topicList[x].id).fadeIn(1e3,function(){})}callback()}function buildForum(forumArr,isChild,callback){for(forum in forumArr){if(!isChild&&forumArr[forum].id&&forumArr[forum].rootDistance==0){$("#forum").append('<li id="forum-'+forumArr[forum].id+'" class="root forum-node">'+'<div class="root-node clearfix">'+'<div class="forum-desc">'+'<div class="forum-title">'+"<h3>"+'<a href="'+HTTP_SERVER+"forums/"+forumArr[forum].alias+"/"+forumArr[forum].id+'">'+forumArr[forum].title+"</a>"+"</h3>"+"</div>"+"</div>"+"</div>"+"</li>");numOfRoots+=1;if(numOfRoots===1){$("#forum-"+forumArr[forum].id+" > div.root-node").addClass("first-root")}else{$("#forum-"+forumArr[forum].id+" > div.root-node").addClass("other-roots")}if(typeof forumArr[forum].children==="object"){$("#forum-"+forumArr[forum].id).append('<table id="forum-'+forumArr[forum].id+'-children" class="forum-children">'+"</table>");for(child in forumArr[forum].children){if(typeof forumArr[forum]!=="undefined"){buildForum(forumArr[forum].children,true)}}}}else if(isChild===true){if(forumArr[forum].id&&$("#forum-"+forumArr[forum].id).length===0&&typeof forumArr[forum]!=="undefined"){if(forumArr[forum].rootDistance<2){if(!forumArr[forum].lastReplyDate){forumArr[forum].lastReplyDate="No Topics Posted"}if(!forumArr[forum].lastReplyDate){forumArr[forum].lastReplyDate=""}$("#forum-"+forumArr[forum].ancestor+"-children").append('<tr id="forum-'+forumArr[forum].id+'" class="forum-child forum-node forum-depth-'+forumArr[forum].rootDistance+'">'+'<td id="forum-attribs-'+forumArr[forum].id+'" class="forum-title">'+"<h4>"+'<a href="'+HTTP_SERVER+"forums/"+forumArr[forum].alias+"/"+forumArr[forum].id+'">'+forumArr[forum].title+"</a>"+"</h4>"+"</td>"+"<td></td>"+'<td class="forum-topic-reply-count">'+"<ul>"+"<li>"+forumArr[forum].numOfTopics+" topics"+"</li>"+"<li>"+forumArr[forum].numOfPosts+" replies"+"</li>"+"</ul>"+"</td>"+'<td class="forum-last-post">'+'<div id="last-reply-avatar-'+forumArr[forum].id+'" class="last-reply-avatar fltlft">'+"</div>"+'<ul id="last-reply-info-'+forumArr[forum].id+'" class="last-reply-info">'+"</ul>"+"</td>"+"</tr>");$("#forum-attribs-"+forumArr[forum].id).append('<div id="forum-description-'+forumArr[forum].id+'" class="forum-description">'+forumArr[forum].description+"</div>");if(!forumArr[forum].hideLastPostInfo||forumArr[forum].hideLastPostInfo==0){if(typeof forumArr[forum].lastReplyUsername!=="undefined"&&forumArr[forum].lastReplyUsername){$("#last-reply-info-"+forumArr[forum].id).append("<li>"+'<a href="'+HTTP_FORUM+"topic/"+forumArr[forum].lastReplyTopicAlias+"/"+forumArr[forum].lastReplyTopic+'">'+forumArr[forum].lastReplyTopicTitle+"</a>"+"</li>");$("#last-reply-info-"+forumArr[forum].id).append("<li>"+'<a href="'+HTTP_SERVER+"forums/user/"+forumArr[forum].lastReplyAlias+"/"+forumArr[forum].lastReplyUserId+'">'+forumArr[forum].lastReplyUsername+"</a>"+"</li>")}else{$("#last-reply-info-"+forumArr[forum].id).css({"margin-top":"10px"})}$("#last-reply-info-"+forumArr[forum].id).append("<li>"+forumArr[forum].lastReplyDate+"</li>");if(forumArr[forum].avatarSmall&&forumArr[forum].lastReplyUserId){$("#last-reply-avatar-"+forumArr[forum].id).append('<img src="'+HTTP_AVATARS+forumArr[forum].avatarSmall+'" alt="'+forumArr[forum].lastReplyUsername+'" title="'+forumArr[forum].lastReplyUsername+'" />')}else if(forumArr[forum].lastReplyUserId&&typeof defaultAvatarSmall!=="undefined"){$("#last-reply-avatar-"+forumArr[forum].id).append('<img src="'+defaultAvatarSmall+'" alt="'+forumArr[forum].lastReplyUsername+'" title="'+forumArr[forum].lastReplyUsername+'" />')}else{$("#last-reply-avatar-"+forumArr[forum].id).append('<div class="no-avatar-small">'+'<div class="inner">'+"NA"+"</div>"+"</div>")}}numOfChildren.total=numOfChildren.currentTotal=forumArr[forum].children.length;if(forumArr[forum].children.length>0){$("#forum-description-"+forumArr[forum].id).before('<table id="forum-'+forumArr[forum].id+'-children" class="sub-forums"></table>');for(child in forumArr[forum].children){if(typeof forumArr[forum]!=="undefined"){if(typeof forumArr[forum].children==="object"){buildForum(forumArr[forum].children,true)}}}}}else{if(numOfChildren.total===numOfChildren.currentTotal){$("#forum-"+forumArr[forum].ancestor+"-children").append("<tr>"+'<td id="sub-forums-for-'+forumArr[forum].ancestor+'"></td>'+"</tr>");$("#sub-forums-for-"+forumArr[forum].ancestor).append('<span class="down-one-level"></span>')}$("#sub-forums-for-"+forumArr[forum].ancestor).append('<a id="subforum-title-'+forumArr[forum].id+'" href="'+HTTP_SERVER+"forums/"+forumArr[forum].alias+"/"+forumArr[forum].id+'">'+forumArr[forum].title+"</a>");numOfChildren.currentTotal-=1;if(numOfChildren.currentTotal!==0){$("#sub-forums-for-"+forumArr[forum].ancestor).append("<span>, </span>")}}}if(typeof forumArr[forum]!=="undefined"){if(typeof forumArr[forum].children==="object"&&forumArr[forum].rootDistance<2){$("#forum-"+forumArr[forum].id).after("<tr>"+"<td>"+'<table id="forum-'+forumArr[forum].id+'-children">'+"</table>"+"</td>"+"</tr>")}}}}if(typeof callback==="function"){callback()}}function bindPostWaypointPermalink(){$(".post-permalink").waypoint(function(direction){var id=$(this).children("a").prop("id").replace("post-permalink-",""),postNumber,totalPosts;postNumber=parseInt($("#post-permalink-"+id).text().replace("#",""));totalPosts=parseInt($("#total-posts").text());if(direction==="up"){if(!$("#current-post").hasClass("rebinding")){$("#current-post").text(postNumber)}setPostScrollerProgress(postNumber);postNumberStr=new String(postNumber+1)}},{offset:"25%"})}function bindPostWaypointFooter(){$(".post-footer").each(function(){$(this).waypoint(function(direction){var id=$(this).prop("id").replace("post-footer-",""),postNumber,totalPosts,postNumberStr;postNumber=parseInt($("#post-permalink-"+id).text().replace("#",""),10);totalPosts=parseInt($("#total-posts").text(),10);if(direction==="down"){$("#current-post").text(postNumber);if(postNumber!==totalPosts&&postNumber!==1){setPostScrollerProgress(postNumber)}else{setPostScrollerProgress(postNumber)}}},{offset:"75%"})})}function bindPostWaypointScrollUp(){$(".load-more-posts-up").waypoint(function(direction){var firstPostId=$("#forum-posts > .post-wrap").first().prop("id").replace("post-",""),postNumber=parseInt($("#post-permalink-"+firstPostId).text().replace("#",""),10),totalPosts=parseInt($("#total-posts").text(),10),topPostId=$("#forum-posts div:first-child").prop("id"),x;if(direction==="up"&&postNumber!==1&&noMorePostsUp.length===0&&autoloadPosts&&(typeof autoloadPostsInProgress==="undefined"||!autoloadPostsInProgress)){$("#posts-loading").Loadingdotdotdot({speed:400,maxDots:4,word:"Loading "}).show();upOffset-=upLimit;if(upOffset<0){upLimit=upLimit-Math.abs(upOffset);upOffset=0}$(".post-permalink").waypoint("destroy");$(".post-footer").waypoint("destroy");$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"load-more-posts-up",fourmId:$("#forum-id").val(),topicId:$("#topic-id").val(),topicAlias:$("#topic-alias").val(),limit:upLimit,offset:upOffset,numOfPosts:numOfPosts,topPostId:topPostId,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data);autoloadPostsInProgress=true;addPosts(response.posts,response.topicAlias,response.modPerms,"up",response,function(response){var firstPostId;numOfPosts=parseInt(numOfPosts)+parseInt(limit);window.setTimeout(function(){firstPostId=$("#forum-posts div:first-child").prop("id").replace("post-","");firstPost=parseInt($("#post-permalink-"+firstPostId).text().replace("#",""));bindPostWaypointPermalink();bindPostWaypointFooter()},10);if(typeof response.noMorePostsUp!=="undefined"){noMorePostsUp=true}window.setTimeout(function(){$("#posts-loading").fadeOut();autoloadPostsInProgress=""},2e3)});return false}})}})}function bindPostWaypointScrollDown(){$("#forum-posts").waypoint(function(direction){var postNumber=parseInt($("#current-post").text(),10),totalPosts=parseInt($("#total-posts").text(),10),bottomPostId=$("#forum-posts div").prop("id");if(direction==="down"){}if(direction==="down"&&postNumber!==totalPosts&&noMorePostsDown.length===0&&$("#post-number-"+totalPosts).length===0&&autoloadPosts&&(typeof autoloadPostsInProgress==="undefined"||!autoloadPostsInProgress)){$("#posts-loading").Loadingdotdotdot({speed:400,maxDots:4,word:"Loading "}).show();downOffset+=downLimit;if(downOffset>totalPosts){downLimit=downOffset-totalPosts;downOffset=totalPosts}$(".post-permalink").waypoint("destroy");$(".post-footer").waypoint("destroy");$(".load-more-posts-up").waypoint("disable");$.ajax({url:HTTP_SERVER+"forums",type:"POST",datatype:"json",data:"appRequest="+encodeURIComponent(JSON.stringify({type:"forum",action:"load-more-posts-down",forumId:$("#forum-id").val(),topicId:$("#topic-id").val(),topicAlias:$("#topic-alias").val(),limit:downLimit,offset:downOffset,numOfPosts:numOfPosts,bottomPostId:bottomPostId,csrfToken:$("#csrf-token").val()})),success:function(data,textStatus,jqXHR){var response=JSON.parse(data),waypointsList,lastWaypoint,lastWaypointId,scrollTop;addPosts(response.posts,response.topicAlias,response.modPerms,"down",response,function(){$("#current-post").addClass("rebinding");bindPostWaypointPermalink();bindPostWaypointFooter();$.waypoints("refresh");$("#current-post").removeClass("rebinding");numOfPosts=parseInt(numOfPosts)+parseInt(response.limit);offset=parseInt(offset)+parseInt(response.limit);if(typeof response.noMorePostsDown!=="undefined"){noMorePostsDown=true}window.setTimeout(function(){$("#posts-loading").fadeOut();$(".load-more-posts-up").waypoint("enable")},2e3)});return false}})}else if(!autoloadPosts&&direction==="down"){$("#post-scroller").css({position:"absolute"})}},{offset:"bottom-in-view"})}function addPosts(posts,topicAlias,modPerms,direction,response,callback){var post,postHeight,postIds={},viewportScroll,x;for(x=0;x<posts.length;x++){postIds[x]=posts[x].id;if(posts[x].username==="Anonymous"){posts[x].forum_post_count=""}post='<div id="post-'+posts[x].id+'" class="post-wrap clearfix post-number-'+posts[x].post_order+'">'+'<div class="inner clearfix">'+'<div class="post clearfix">'+'<div class="post-head">'+'<span class="post-username">'+'<a id="username-for-post-'+posts[x].id+'" href="'+HTTP_SERVER+"forums/user/"+posts[x].username_alias+"/"+posts[x].user_id+'">'+posts[x].username+"</a>"+"</span>"+'<span class="post-permalink">'+'<a id="post-permalink-'+posts[x].id+'" href="'+HTTP_SERVER+"forums/topic/"+topicAlias+"/"+posts[x].topic_id+"/"+posts[x].id+'#" title="Permalink for post '+posts[x].post_order+'">'+"#"+posts[x].post_order+"</a>"+"</span>"+"</div>"+'<div class="main-post">'+'<div class="post-author-info">'+'<input type="hidden" id="post-'+posts[x].id+'-userid" value="'+posts[x].user_id+'" />'+'<p class="post-role">'+response.highest_ranked_role[posts[x].id]+"</p>"+'<div id="user-avatar-'+posts[x].id+'" class="user-avatar">'+"</div>"+'<p id="user-post-count-'+posts[x].id+'" class="post-user-post-count">'+'<span class="post-count-for-'+posts[x].user_id+'">'+posts[x].forum_post_count+" "+"</span>"+'<span class="post-count-label-for-'+posts[x].user_id+'">'+posts[x].post_count_label+"</span>"+"</p>"+"</div>"+'<div class="post-body clearfix">'+'<p id="posted-info-'+posts[x].id+'" class="posted-info">'+"Posted "+posts[x].date_posted+"</p>"+'<div id="post-content-'+posts[x].id+'" class="post-content">'+posts[x].post_content+"</div>"+"</div>"+"</div>"+'<div id="post-footer-'+posts[x].id+'" class="post-footer clearfix">'+'<ul id="post-menu-'+posts[x].id+'" class="post-menu">'+"</ul>"+"</div>"+"</div>"+"</div>"+"</div>";if(direction==="down"&&$("#post-"+posts[x].id).length===0){$("#forum-posts").append(post)}else if(direction==="up"&&$("#post-"+posts[x].id).length===0){$("#forum-posts").prepend(post);viewportScroll=$(window).scrollTop();postHeight=$("#post-"+posts[x].id).height();$(window).scrollTop(viewportScroll+postHeight+40)}if(typeof posts[x].avatar!=="undefined"&&posts[x].avatar){$("#user-avatar-"+posts[x].id).append('<div class="avatar">'+'<img src="'+HTTP_AVATARS+posts[x].avatar+'" alt="'+posts[x].username+'" title="'+posts[x].username+'" />'+"</div>")}else if(typeof defaultAvatar!=="undefined"&&defaultAvatar){$("#user-avatar-"+posts[x].id).append('<div class="avatar">'+'<img src="'+defaultAvatar+'" alt="'+posts[x].username+'" title="'+posts[x].username+'" />'+"</div>")}else{$("#user-avatar-"+posts[x].id).append('<div class="no-avatar">'+'<div class="inner">'+"<span>No Avatar</span>"+"</div>"+"</div>")}if(typeof modPerms!=="undefined"&&modPerms[posts[x].id]["delete"]){$("#post-menu-"+posts[x].id).append('<li id="delete-post-'+posts[x].id+'" class="post-menu-delete">'+"Delete"+"</li>")}if(typeof modPerms!=="undefined"&&modPerms[posts[x].id]["edit"]){$("#post-menu-"+posts[x].id).append('<li id="edit-post-'+posts[x].id+'" class="post-menu-edit">'+"Edit"+"</li>")}if(typeof username!=="undefined"){$("#post-menu-"+posts[x].id).append('<li id="quote-post-'+posts[x].id+'" class="post-menu-quote">'+"Quote"+"</li>"+'<li id="report-post-'+posts[x].id+'" class="post-menu-report">'+"Report"+"</li>")}if(posts[x].best_answer!=1&&typeof userId!=="undefined"&&userId===topic.user_id&&forum.best_answer==1&&forum.topic_starter_best_answer==1||typeof modPerms!=="undefined"&&modPerms[posts[x].id]["toggle_answered"]){if(parseInt(posts[x].post_order)!==1){if($("#best-answer-post-"+posts[x].id).length===0){$("#quote-post-"+posts[x].id).after('<li id="best-answer-post-'+posts[x].id+'" class="post-menu-best-answer">'+'<span class="ui-icon ui-icon-check"></span>'+"<span>Best Answer</span>"+"</li>")}}}if(posts[x].best_answer==1){$("#posted-info-"+posts[x].id).after('<p class="best-answer">'+'<span class="ui-icon ui-icon-check"></span>'+"<span>Best Answer</span>"+"</p>")}}callback(response)}function setPostScrollerProgress(postNumber){var totalPosts;totalPosts=parseInt($("#total-posts").text(),10);$("#post-scroller > .inner > .bkgd").css({"border-right-width":"1px",width:postNumber/totalPosts*100+"%"})}function paginateTopics(){$(".topic-row").each(function(){var id=$(this).prop("id").replace("topic-",""),alias=$(this).attr("data-alias"),numOfPosts=parseInt($(this).attr("data-num-of-posts"),10),paginated=$(this).attr("data-paginated"),numOfPages=0,maxPages=10,pager,x;if(paginated==="false"){numOfPages=Math.ceil(numOfPosts/RB.forum.postsPerPage);if(numOfPages===1){return}pager='<ul class="topic-pager">';for(x=1;x<=numOfPages;x++){if(x<maxPages&&x<numOfPages-3){pager+='<li class="topic-page">'+'<a href="'+HTTP_FORUM+"topic/"+alias+"/"+id+"/page-"+x+'">'+x;"</a>"+"<li>"}else if(x>=numOfPages-3){if(x===numOfPages-3&&numOfPages>10){pager+='<li class="topic-page dots">'+"...";"</li>"}else{pager+='<li class="topic-page">'+'<a href="'+HTTP_FORUM+"topic/"+alias+"/"+id+"/page-"+x+'">'+x;"</a>"+"<li>"}}}pager+="</ul>";$("#topic-title-"+id).append(pager);pager="";$(this).attr("data-paginated","true")}})}function setActiveUsers(activeUsers){var usersOnline="",x;for(x=0;x<activeUsers.length;x++){usersOnline+="<span>"+'<a href="'+HTTP_FORUM+"user/"+activeUsers[x].usernameAlias+"/"+activeUsers[x].userId+'">'+activeUsers[x].username+"</a>";if(x<activeUsers.length-1){usersOnline+=", "}usersOnline+="</span>"}$("#users-online").html(usersOnline)}function buildPoll(poll){var choice,totalVotes=0,percentOfVote,votes;$("#forum-poll-choices, #forum-poll-results").html("");$("#poll-id").val(poll[0]["poll_id"]);$("#forum-poll-title").text(poll[0]["title"]);for(choice in poll){totalVotes+=parseInt(poll[choice].votes,10)}for(choice in poll){$("#forum-poll-choices").append("<li>"+'<label class="center-label">'+'<input id="choice-'+poll[choice].id+'" type="radio" class="poll-choice center-toggle" name="pollChoice[]" value="'+poll[choice].id+'" />'+poll[choice].choice+"</label>"+"</li>");votes=parseInt(poll[choice].votes,10);if(totalVotes===0){percentOfVote=0}else{percentOfVote=parseFloat(votes/totalVotes).toFixed(2)}percentOfVote*=100;$("#forum-poll-results").append("<li>"+'<div class="poll-result-choice" data-votes="'+votes+'">'+poll[choice].choice+'<span class="votes-for-choice">'+"( "+poll[choice].votes+" votes ["+percentOfVote+"%] )"+"</span>"+"</div>"+'<div class="progress-bar topic-poll">'+'<span style="width: '+percentOfVote+'%;"></span>'+"</div>"+"</li>")}$("#forum-poll").show()}